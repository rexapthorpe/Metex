<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Edit Success Modal - Pricing Display</title>
    <link rel="stylesheet" href="/static/css/modals/edit_listing_confirmation_modals.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            padding: 12px 24px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
        }
        .test-button:hover {
            background: #0056b3;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .instructions {
            background: #e7f3ff;
            padding: 15px;
            border-left: 4px solid #007bff;
            margin: 20px 0;
        }
        .console-output {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç Edit Success Modal - Pricing Display Test</h1>

        <div class="instructions">
            <strong>Instructions:</strong>
            <ol>
                <li>Open browser console (F12) to see detailed logs</li>
                <li>Click a test button below to open the modal with test data</li>
                <li>Verify all pricing fields are displayed correctly</li>
            </ol>
        </div>

        <div>
            <button class="test-button" onclick="testFixedPricing()">Test Fixed Pricing Modal</button>
            <button class="test-button" onclick="testPremiumToSpot()">Test Premium-to-Spot Modal</button>
        </div>

        <div class="console-output" id="console-output">
            Console output will appear here...
        </div>
    </div>

    <!-- Include the modal template -->
    <div id="editListingSuccessModal" class="edit-success-overlay" style="display: none;">
        <div class="edit-success-dialog">
            <button type="button" class="modal-close" onclick="closeEditListingSuccessModal()" aria-label="Close">&times;</button>

            <div class="modal-header success-header">
                <h2>üéâ Listing Updated Successfully!</h2>
            </div>

            <div class="modal-body">
                <div class="success-content">
                    <p class="success-message">Your listing has been updated successfully!</p>

                    <div class="order-details">
                        <h3>Updated Listing Summary</h3>

                        <div class="detail-section">
                            <h4>Item Details</h4>
                            <div class="detail-row">
                                <span class="detail-label">Metal:</span>
                                <span class="detail-value" id="success-metal">‚Äî</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Product Line:</span>
                                <span class="detail-value" id="success-product-line">‚Äî</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Quantity:</span>
                                <span class="detail-value" id="success-quantity">‚Äî</span>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h4>Pricing Details</h4>

                            <!-- Pricing Mode -->
                            <div class="detail-row">
                                <span class="detail-label">Pricing Mode:</span>
                                <span class="detail-value" id="success-pricing-mode">‚Äî</span>
                            </div>

                            <!-- Variable Pricing: Current Spot Price -->
                            <div class="detail-row" id="success-current-spot-row" style="display: none;">
                                <span class="detail-label">Current Spot Price:</span>
                                <span class="detail-value" id="success-current-spot">‚Äî</span>
                            </div>

                            <!-- Variable Pricing Fields -->
                            <div class="detail-row" id="success-premium-row" style="display: none;">
                                <span class="detail-label">Premium Above Spot:</span>
                                <span class="detail-value" id="success-premium">‚Äî</span>
                            </div>

                            <div class="detail-row" id="success-floor-row" style="display: none;">
                                <span class="detail-label">Floor Price (Minimum):</span>
                                <span class="detail-value" id="success-floor">‚Äî</span>
                            </div>

                            <div class="detail-row" id="success-effective-row" style="display: none;">
                                <span class="detail-label">Current Effective Price:</span>
                                <span class="detail-value price-highlight" id="success-effective">‚Äî</span>
                            </div>

                            <!-- Static Pricing Field -->
                            <div class="detail-row" id="success-static-price-row" style="display: none;">
                                <span class="detail-label">Price per Item:</span>
                                <span class="detail-value price-highlight" id="success-static-price">‚Äî</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer success-footer">
                <hr class="footer-divider">
                <button type="button" class="btn btn-primary" onclick="closeEditListingSuccessModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Logger to show output on page
        function log(message) {
            const output = document.getElementById('console-output');
            output.innerHTML += message + '\n';
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }

        // Test Fixed Pricing
        function testFixedPricing() {
            log('========================================');
            log('üß™ Testing FIXED PRICING Modal');
            log('========================================');

            const testData = {
                success: true,
                listingId: 123,
                metal: 'Silver',
                productLine: 'American Eagle',
                productType: 'Coin',
                quantity: 10,
                pricingMode: 'static',
                pricePerCoin: 37.50
            };

            log('Test data: ' + JSON.stringify(testData, null, 2));
            log('Opening modal...');

            openEditListingSuccessModal(testData);

            log('‚úÖ Modal opened - Check that you see:');
            log('   - Pricing Mode: Fixed Price');
            log('   - Price per Item: $37.50');
            log('   - NO premium/floor/effective fields');
        }

        // Test Premium to Spot
        function testPremiumToSpot() {
            log('========================================');
            log('üß™ Testing PREMIUM-TO-SPOT Modal');
            log('========================================');

            const testData = {
                success: true,
                listingId: 456,
                metal: 'Silver',
                productLine: 'American Eagle',
                productType: 'Coin',
                quantity: 10,
                pricingMode: 'premium_to_spot',
                currentSpotPrice: 57.17,
                spotPremium: 5.00,
                floorPrice: 32.00,
                effectivePrice: 62.17,
                pricingMetal: 'Silver'
            };

            log('Test data: ' + JSON.stringify(testData, null, 2));
            log('Opening modal...');

            openEditListingSuccessModal(testData);

            log('‚úÖ Modal opened - Check that you see ALL 5 fields:');
            log('   1. Pricing Mode: Variable (Premium to Spot)');
            log('   2. Current Spot Price: $57.17/oz');
            log('   3. Premium Above Spot: $5.00');
            log('   4. Floor Price (Minimum): $32.00');
            log('   5. Current Effective Price: $62.17');
        }

        // Open success modal function
        function openEditListingSuccessModal(data) {
            const modal = document.getElementById('editListingSuccessModal');

            if (!modal) {
                log('‚ùå ERROR: Modal element not found!');
                return;
            }

            log('üìã Populating modal with data...');

            // Determine pricing mode
            const pricingMode = data.pricingMode || 'static';
            const isVariablePricing = pricingMode === 'premium_to_spot';

            log(`   Pricing mode: ${pricingMode}`);
            log(`   Is variable pricing: ${isVariablePricing}`);

            // Populate item details
            document.getElementById('success-metal').textContent = data.metal || '‚Äî';
            document.getElementById('success-product-line').textContent = data.productLine || '‚Äî';
            document.getElementById('success-quantity').textContent = data.quantity || '‚Äî';

            // Set pricing mode
            const pricingModeEl = document.getElementById('success-pricing-mode');
            if (pricingModeEl) {
                pricingModeEl.textContent = isVariablePricing ? 'Variable (Premium to Spot)' : 'Fixed Price';
                log(`   ‚úì Pricing mode set to: ${pricingModeEl.textContent}`);
            }

            // Get all pricing elements
            const currentSpotRow = document.getElementById('success-current-spot-row');
            const currentSpotEl = document.getElementById('success-current-spot');
            const premiumRow = document.getElementById('success-premium-row');
            const premiumEl = document.getElementById('success-premium');
            const floorRow = document.getElementById('success-floor-row');
            const floorEl = document.getElementById('success-floor');
            const effectiveRow = document.getElementById('success-effective-row');
            const effectiveEl = document.getElementById('success-effective');
            const staticPriceRow = document.getElementById('success-static-price-row');
            const staticPriceEl = document.getElementById('success-static-price');

            if (isVariablePricing) {
                log('üìä Showing VARIABLE PRICING fields:');

                // Show current spot price
                if (currentSpotRow && currentSpotEl) {
                    currentSpotRow.style.display = 'flex';
                    if (data.currentSpotPrice !== undefined && !isNaN(data.currentSpotPrice)) {
                        currentSpotEl.textContent = `$${parseFloat(data.currentSpotPrice).toFixed(2)}/oz`;
                        log(`   ‚úì Current Spot Price: ${currentSpotEl.textContent}`);
                    }
                } else {
                    log('   ‚ùå Current spot price elements not found!');
                }

                // Show premium
                if (premiumRow && premiumEl) {
                    premiumRow.style.display = 'flex';
                    if (data.spotPremium !== undefined && data.spotPremium !== '') {
                        premiumEl.textContent = `$${parseFloat(data.spotPremium).toFixed(2)}`;
                        log(`   ‚úì Premium Above Spot: ${premiumEl.textContent}`);
                    }
                } else {
                    log('   ‚ùå Premium elements not found!');
                }

                // Show floor price
                if (floorRow && floorEl) {
                    floorRow.style.display = 'flex';
                    if (data.floorPrice !== undefined && data.floorPrice !== '') {
                        floorEl.textContent = `$${parseFloat(data.floorPrice).toFixed(2)}`;
                        log(`   ‚úì Floor Price: ${floorEl.textContent}`);
                    }
                } else {
                    log('   ‚ùå Floor price elements not found!');
                }

                // Show effective price
                if (effectiveRow && effectiveEl) {
                    effectiveRow.style.display = 'flex';
                    if (data.effectivePrice !== undefined && !isNaN(data.effectivePrice)) {
                        effectiveEl.textContent = `$${parseFloat(data.effectivePrice).toFixed(2)}`;
                        log(`   ‚úì Effective Price: ${effectiveEl.textContent}`);
                    }
                } else {
                    log('   ‚ùå Effective price elements not found!');
                }

                // Hide static price
                if (staticPriceRow) staticPriceRow.style.display = 'none';

            } else {
                log('üíµ Showing FIXED PRICING field:');

                // Hide variable pricing fields
                if (currentSpotRow) currentSpotRow.style.display = 'none';
                if (premiumRow) premiumRow.style.display = 'none';
                if (floorRow) floorRow.style.display = 'none';
                if (effectiveRow) effectiveRow.style.display = 'none';

                // Show static price
                if (staticPriceRow && staticPriceEl) {
                    staticPriceRow.style.display = 'flex';
                    if (data.pricePerCoin !== undefined && data.pricePerCoin !== '') {
                        staticPriceEl.textContent = `$${parseFloat(data.pricePerCoin).toFixed(2)}`;
                        log(`   ‚úì Price per Item: ${staticPriceEl.textContent}`);
                    }
                } else {
                    log('   ‚ùå Static price elements not found!');
                }
            }

            // Show modal
            modal.style.display = 'flex';
            requestAnimationFrame(() => {
                modal.classList.add('active');
            });

            log('‚úÖ Modal display complete!');
            log('========================================\n');
        }

        // Close modal function
        function closeEditListingSuccessModal() {
            const modal = document.getElementById('editListingSuccessModal');
            if (!modal) return;

            modal.classList.add('hiding');
            modal.classList.remove('active');

            setTimeout(() => {
                modal.style.display = 'none';
                modal.classList.remove('hiding');
            }, 300);

            log('Modal closed.');
        }

        // Initial message
        log('Test page loaded. Click a button to test the modal.');
        log('Open browser console (F12) for more detailed logs.\n');
    </script>
</body>
</html>
