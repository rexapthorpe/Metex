<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification Button Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h2 {
            margin-top: 0;
            color: #333;
        }
        .notification-tile {
            background: white;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            gap: 15px;
        }
        .notification-content {
            flex: 1;
        }
        .notification-title {
            font-weight: bold;
            margin: 0 0 8px 0;
        }
        .notification-message {
            color: #666;
            margin: 0 0 8px 0;
        }
        .notification-time {
            font-size: 12px;
            color: #999;
        }
        .notification-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .notification-goto-btn {
            background: #3da6ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .notification-goto-btn:hover {
            background: #2b8ce6;
        }
        .notification-delete-btn {
            background: white;
            color: #ff4757;
            border: 1px solid #ff4757;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .test-result.pass {
            background: #d4edda;
            color: #155724;
        }
        .test-result.fail {
            background: #f8d7da;
            color: #721c24;
        }
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        .console-output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .console-output div {
            margin: 2px 0;
        }
    </style>
</head>
<body>
    <h1>Notification "View Order" Button Test</h1>

    <div class="test-section">
        <h2>Test 1: Button Click Handler Attachment</h2>
        <p>This test verifies that click handlers are properly attached to notification buttons.</p>
        <div id="test1-notification"></div>
        <div id="test1-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Navigation Simulation (Bid Filled)</h2>
        <p>Click the "View Order" button below. It should navigate to /account#orders</p>
        <div id="test2-notification"></div>
        <div class="test-result info">
            <strong>Note:</strong> Since this is a test file, navigation will be prevented.
            Check the console output below to see if the navigation would have occurred.
        </div>
    </div>

    <div class="test-section">
        <h2>Test 3: Navigation Simulation (Listing Sold)</h2>
        <p>Click the "View Sold" button below. It should navigate to /account#sold</p>
        <div id="test3-notification"></div>
    </div>

    <div class="test-section">
        <h2>Console Output</h2>
        <div class="console-output" id="consoleOutput"></div>
    </div>

    <script>
        // Console logging to UI
        const consoleOutput = document.getElementById('consoleOutput');
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            div.textContent = `[${timestamp}] ${message}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            console.log(message);
        }

        // Override window.location.href to prevent actual navigation
        let navigationAttempt = null;
        Object.defineProperty(window.location, 'href', {
            set: function(url) {
                navigationAttempt = url;
                log(`Navigation intercepted: ${url}`, 'success');
            },
            get: function() {
                return window.location.toString();
            }
        });

        // Simulate the createNotificationTile function from notifications.js
        function createNotificationTile(notification) {
            log('Creating notification tile...');

            const tile = document.createElement('div');
            tile.className = 'notification-tile';
            tile.setAttribute('data-notification-id', notification.id);
            tile.setAttribute('data-type', notification.type);

            // Determine button text and link based on type
            let buttonText = 'View';
            let targetUrl = '/account';

            if (notification.type === 'bid_filled') {
                buttonText = 'View Order';
                targetUrl = '/account#orders';
                log(`Button type: ${buttonText}, Target: ${targetUrl}`);
            } else if (notification.type === 'listing_sold') {
                buttonText = 'View Sold';
                targetUrl = '/account#sold';
                log(`Button type: ${buttonText}, Target: ${targetUrl}`);
            }

            tile.innerHTML = `
                <div class="notification-content">
                    <h4 class="notification-title">${notification.title}</h4>
                    <p class="notification-message">${notification.message}</p>
                    <p class="notification-time">Just now</p>
                </div>
                <div class="notification-actions">
                    <button class="notification-delete-btn" data-notification-id="${notification.id}">
                        üóëÔ∏è
                    </button>
                    <button class="notification-goto-btn" data-notification-id="${notification.id}" data-url="${targetUrl}">
                        ${buttonText}
                    </button>
                </div>
            `;

            // Add event listeners
            const deleteBtn = tile.querySelector('.notification-delete-btn');
            const gotoBtn = tile.querySelector('.notification-goto-btn');

            log('Attaching event listeners...');

            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                log('Delete button clicked', 'info');
            });

            gotoBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                log('Go to button clicked!', 'success');
                handleGotoClick(notification.id, targetUrl);
            });

            log('Event listeners attached successfully', 'success');
            return tile;
        }

        // Simulate the handleGotoClick function
        function handleGotoClick(notificationId, targetUrl) {
            log(`handleGotoClick called with ID: ${notificationId}, URL: ${targetUrl}`, 'success');

            // In real app, this would mark as read via fetch
            // For testing, we'll just simulate navigation
            log('Simulating navigation...', 'info');
            window.location.href = targetUrl;
        }

        // Test 1: Verify click handler attachment
        log('Starting Test 1: Click Handler Attachment');
        const test1Container = document.getElementById('test1-notification');
        const test1Result = document.getElementById('test1-result');

        const test1Notification = {
            id: 1,
            type: 'bid_filled',
            title: 'Test Bid Filled',
            message: 'Testing click handler attachment'
        };

        const test1Tile = createNotificationTile(test1Notification);
        test1Container.appendChild(test1Tile);

        // Verify button exists and has event listener
        const test1Btn = test1Tile.querySelector('.notification-goto-btn');
        if (test1Btn) {
            test1Result.innerHTML = '<div class="test-result pass">‚úì PASS: Button created and event listener attached</div>';
            log('Test 1: PASS', 'success');
        } else {
            test1Result.innerHTML = '<div class="test-result fail">‚úó FAIL: Button not found</div>';
            log('Test 1: FAIL', 'error');
        }

        // Test 2: Bid Filled Navigation
        log('Starting Test 2: Bid Filled Navigation');
        const test2Container = document.getElementById('test2-notification');

        const test2Notification = {
            id: 2,
            type: 'bid_filled',
            title: 'Your Bid Has Been Filled!',
            message: 'Click "View Order" to test navigation to Orders tab'
        };

        const test2Tile = createNotificationTile(test2Notification);
        test2Container.appendChild(test2Tile);

        // Test 3: Listing Sold Navigation
        log('Starting Test 3: Listing Sold Navigation');
        const test3Container = document.getElementById('test3-notification');

        const test3Notification = {
            id: 3,
            type: 'listing_sold',
            title: 'Your Listing Has Been Sold!',
            message: 'Click "View Sold" to test navigation to Sold tab'
        };

        const test3Tile = createNotificationTile(test3Notification);
        test3Container.appendChild(test3Tile);

        log('All tests initialized. Click the buttons to test navigation.', 'info');
    </script>
</body>
</html>
