<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Full Bid Modal Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-controls {
      max-width: 600px;
      margin: 0 auto 20px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .test-btn {
      padding: 12px 24px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
    }
    .test-btn:hover {
      background: #1565c0;
    }
    .console-output {
      max-width: 600px;
      margin: 20px auto;
      background: #1e1e1e;
      color: #00ff00;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
    .console-line {
      margin: 2px 0;
    }
    .console-error {
      color: #ff6b6b;
    }
    .console-success {
      color: #51cf66;
    }
    .console-info {
      color: #74c0fc;
    }
  </style>
  <link rel="stylesheet" href="/static/css/modals/bid_modal.css">
</head>
<body>
  <div class="test-controls">
    <h1>Full Bid Modal Test</h1>
    <p>This test simulates the complete bid modal flow with actual backend integration.</p>

    <div style="margin: 20px 0;">
      <button class="test-btn" onclick="testCreateBid()">Test CREATE Bid Modal</button>
      <button class="test-btn" onclick="testEditBid()">Test EDIT Bid Modal</button>
      <button class="test-btn" onclick="clearConsole()">Clear Console</button>
    </div>

    <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 4px; border-left: 4px solid #ffc107;">
      <strong>Test Instructions:</strong>
      <ol style="margin: 10px 0; padding-left: 20px; line-height: 1.6;">
        <li>Click "Test CREATE Bid Modal" to open create mode</li>
        <li>Switch between "Fixed Price" and "Variable (Premium to Spot)"</li>
        <li>Verify the fields change appropriately</li>
        <li>Check console output below for any errors</li>
        <li>Close modal and try "Test EDIT Bid Modal"</li>
      </ol>
    </div>
  </div>

  <div id="consoleOutput" class="console-output">
    <div class="console-line console-info">Console output will appear here...</div>
  </div>

  <!-- Include the actual bid modal HTML -->
  <div id="bidModal" class="modal" style="display:none">
    <div class="modal-content bid-modal-content">
      <div id="bidModalContent">
        <button type="button" class="modal-close" onclick="closeBidModal()" aria-label="Close modal">×</button>
        <div class="modal-loading">Loading bid form...</div>
      </div>
    </div>
  </div>

  <!-- Include the actual bid modal JS -->
  <script src="/static/js/modals/bid_modal.js"></script>

  <script>
    // Console output capture
    const consoleDiv = document.getElementById('consoleOutput');

    function addConsoleLog(message, type = 'info') {
      const line = document.createElement('div');
      line.className = `console-line console-${type}`;
      line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      consoleDiv.appendChild(line);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }

    function clearConsole() {
      consoleDiv.innerHTML = '<div class="console-line console-info">Console cleared...</div>';
    }

    // Override console methods to capture output
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;

    console.log = function(...args) {
      originalLog.apply(console, args);
      addConsoleLog(args.join(' '), 'info');
    };

    console.error = function(...args) {
      originalError.apply(console, args);
      addConsoleLog('ERROR: ' + args.join(' '), 'error');
    };

    console.warn = function(...args) {
      originalWarn.apply(console, args);
      addConsoleLog('WARN: ' + args.join(' '), 'info');
    };

    // Test functions
    function testCreateBid() {
      addConsoleLog('=== Testing CREATE Bid Modal ===', 'success');
      addConsoleLog('Opening modal for bucket_id=1 (create mode)...', 'info');

      // Call the actual openBidModal function
      // Note: You'll need to replace bucket_id with an actual ID from your database
      openBidModal(1, null);
    }

    function testEditBid() {
      addConsoleLog('=== Testing EDIT Bid Modal ===', 'success');
      addConsoleLog('Opening modal for bucket_id=1, bid_id=1 (edit mode)...', 'info');

      // Call the actual openBidModal function
      // Note: You'll need to replace bucket_id and bid_id with actual IDs from your database
      openBidModal(1, 1);
    }

    // Monitor modal events
    window.addEventListener('DOMContentLoaded', () => {
      addConsoleLog('Page loaded successfully', 'success');
      addConsoleLog('Bid modal script loaded', 'success');
      addConsoleLog('Ready for testing', 'success');
    });

    // Monitor for initialization success
    const observer = new MutationObserver((mutations) => {
      for (const mutation of mutations) {
        if (mutation.type === 'childList') {
          const bidForm = document.getElementById('bid-form');
          if (bidForm) {
            addConsoleLog('✓ Bid form loaded successfully', 'success');

            const pricingMode = document.getElementById('bid-pricing-mode');
            if (pricingMode) {
              addConsoleLog('✓ Pricing mode selector found', 'success');

              // Add event listener to log mode changes
              pricingMode.addEventListener('change', (e) => {
                addConsoleLog(`Pricing mode changed to: ${e.target.value}`, 'info');
              });
            } else {
              addConsoleLog('✗ Pricing mode selector NOT found', 'error');
            }

            const errorMsg = document.querySelector('.error-msg');
            if (errorMsg) {
              addConsoleLog('✗ Error message detected: ' + errorMsg.textContent, 'error');
            }
          }
        }
      }
    });

    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  </script>
</body>
</html>
