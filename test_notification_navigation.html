<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification Navigation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        .test-section h2 {
            margin-top: 0;
            color: #666;
        }

        /* Simulate account page layout */
        .account-layout {
            display: flex;
            gap: 20px;
            border: 2px solid #007bff;
            border-radius: 8px;
            overflow: hidden;
        }
        .account-sidebar {
            width: 200px;
            background: #f8f9fa;
            padding: 20px;
        }
        .account-sidebar ul {
            list-style: none;
            padding: 0;
        }
        .account-sidebar li {
            padding: 10px;
            cursor: pointer;
            border-radius: 4px;
            margin: 5px 0;
        }
        .account-sidebar li:hover {
            background: #e9ecef;
        }
        .account-sidebar li.active {
            background: #007bff;
            color: white;
        }
        .account-content {
            flex: 1;
            padding: 20px;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: #f8f9fa;
        }
        .tab-content h3 {
            margin-top: 0;
        }

        /* Notification sidebar */
        .notification-sidebar {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100%;
            background: white;
            box-shadow: -2px 0 8px rgba(0,0,0,0.2);
            transition: right 0.3s;
            z-index: 1000;
            overflow-y: auto;
        }
        .notification-sidebar.open {
            right: 0;
        }
        .notification-sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e1e1e1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .notification-list {
            padding: 10px;
        }
        .notification-tile {
            background: white;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            gap: 15px;
        }
        .notification-content {
            flex: 1;
        }
        .notification-title {
            font-weight: bold;
            margin: 0 0 8px 0;
        }
        .notification-message {
            color: #666;
            margin: 0 0 8px 0;
            font-size: 14px;
        }
        .notification-time {
            font-size: 12px;
            color: #999;
        }
        .notification-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .notification-goto-btn {
            background: #3da6ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .notification-goto-btn:hover {
            background: #2b8ce6;
        }
        .notification-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        .notification-overlay.show {
            display: block;
        }
        .notification-close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        /* Test controls */
        .test-controls {
            margin: 20px 0;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 4px;
        }
        .test-controls button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-controls button:hover {
            background: #0056b3;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .test-result.pass {
            background: #d4edda;
            color: #155724;
        }
        .test-result.fail {
            background: #f8d7da;
            color: #721c24;
        }
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        .console-output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .console-output div {
            margin: 2px 0;
        }
        .bell-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #007bff;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            z-index: 1001;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Notification "View Order" Navigation Test</h1>

        <div class="test-section">
            <h2>Test Instructions</h2>
            <ol>
                <li>Click the bell icon (top right) to open notifications</li>
                <li>Click "View Order" on the bid notification</li>
                <li>The Orders tab should automatically become active</li>
                <li>Click "View Sold" on the listing notification</li>
                <li>The Sold tab should automatically become active</li>
            </ol>
        </div>

        <div class="test-controls">
            <h3>Quick Test Actions</h3>
            <button onclick="openNotificationSidebar()">Open Notifications</button>
            <button onclick="testBidNavigation()">Test Bid â†’ Orders</button>
            <button onclick="testListingNavigation()">Test Listing â†’ Sold</button>
            <button onclick="clearConsole()">Clear Console</button>
        </div>

        <div class="test-section">
            <h2>Simulated Account Page</h2>
            <div class="account-layout">
                <div class="account-sidebar">
                    <ul>
                        <li onclick="showTab('cart')">Cart Items</li>
                        <li onclick="showTab('bids')">My Bids</li>
                        <li onclick="showTab('listings')">Listings</li>
                        <li onclick="showTab('sold')">Sold Items</li>
                        <li onclick="showTab('orders')">Orders</li>
                    </ul>
                </div>
                <div class="account-content">
                    <div id="cart-tab" class="tab-content">
                        <h3>Cart Tab</h3>
                        <p>This is the cart tab content</p>
                    </div>
                    <div id="bids-tab" class="tab-content">
                        <h3>Bids Tab</h3>
                        <p>This is the bids tab content</p>
                    </div>
                    <div id="listings-tab" class="tab-content">
                        <h3>Listings Tab</h3>
                        <p>This is the listings tab content</p>
                    </div>
                    <div id="sold-tab" class="tab-content">
                        <h3>Sold Items Tab</h3>
                        <p>This is the sold items tab content</p>
                    </div>
                    <div id="orders-tab" class="tab-content">
                        <h3>Orders Tab</h3>
                        <p>This is the orders tab content</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Console Output</h2>
            <div class="console-output" id="consoleOutput"></div>
        </div>
    </div>

    <!-- Bell button -->
    <button class="bell-btn" onclick="toggleNotificationSidebar()">ðŸ””</button>

    <!-- Notification Sidebar -->
    <div class="notification-sidebar" id="notificationSidebar">
        <div class="notification-sidebar-header">
            <h3>Notifications</h3>
            <button class="notification-close-btn" onclick="closeNotificationSidebar()">Ã—</button>
        </div>
        <div class="notification-list" id="notificationList"></div>
    </div>

    <!-- Notification Overlay -->
    <div class="notification-overlay" id="notificationOverlay" onclick="closeNotificationSidebar()"></div>

    <script>
        // Console logging to UI
        const consoleOutput = document.getElementById('consoleOutput');
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            div.textContent = `[${timestamp}] ${message}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            console.log(message);
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
        }

        // ===================================
        // TAB SWITCHING (from account.js)
        // ===================================
        function showTab(tabName) {
            log(`showTab() called with: ${tabName}`, 'info');

            // Hide all tab panels
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Show the active tab
            const active = document.getElementById(`${tabName}-tab`);
            if (active) {
                active.style.display = 'block';
                log(`âœ“ Tab switched to: ${tabName}`, 'success');
            } else {
                log(`âœ— Tab not found: ${tabName}`, 'error');
            }

            // Highlight active sidebar tab
            document.querySelectorAll('.account-sidebar li').forEach(item => {
                item.classList.remove('active');
                const clickAttr = item.getAttribute('onclick') || '';
                if (clickAttr.includes(`'${tabName}'`)) {
                    item.classList.add('active');
                }
            });
        }

        // Initial tab on page load
        document.addEventListener('DOMContentLoaded', () => {
            const tabFromHash = window.location.hash.slice(1);
            const validTabs = ['cart','bids','listings','sold','orders'];
            const tab = validTabs.includes(tabFromHash) ? tabFromHash : 'cart';
            log('DOMContentLoaded - Initial tab setup', 'info');
            showTab(tab);
        });

        // THE FIX: Handle hash changes
        window.addEventListener('hashchange', () => {
            const tabFromHash = window.location.hash.slice(1);
            const validTabs = ['cart','bids','listings','sold','orders'];
            log(`hashchange event fired! New hash: #${tabFromHash}`, 'success');
            if (validTabs.includes(tabFromHash)) {
                showTab(tabFromHash);
            } else {
                log(`Invalid tab in hash: ${tabFromHash}`, 'error');
            }
        });

        // ===================================
        // NOTIFICATION SYSTEM
        // ===================================
        const sidebar = document.getElementById('notificationSidebar');
        const overlay = document.getElementById('notificationOverlay');
        const notificationList = document.getElementById('notificationList');
        let isNotificationSidebarOpen = false;

        function toggleNotificationSidebar() {
            if (isNotificationSidebarOpen) {
                closeNotificationSidebar();
            } else {
                openNotificationSidebar();
            }
        }

        function openNotificationSidebar() {
            log('Opening notification sidebar', 'info');
            isNotificationSidebarOpen = true;
            sidebar.classList.add('open');
            overlay.classList.add('show');
            loadNotifications();
        }

        function closeNotificationSidebar() {
            log('Closing notification sidebar', 'info');
            isNotificationSidebarOpen = false;
            sidebar.classList.remove('open');
            overlay.classList.remove('show');
        }

        function loadNotifications() {
            log('Loading notifications', 'info');
            notificationList.innerHTML = '';

            // Create sample notifications
            const notifications = [
                {
                    id: 1,
                    type: 'bid_filled',
                    title: 'Your Bid Has Been Filled!',
                    message: 'Your bid for 10 Silver Eagles has been filled at $30.00 each',
                    created_at: new Date()
                },
                {
                    id: 2,
                    type: 'listing_sold',
                    title: 'Your Listing Has Been Sold!',
                    message: 'Your listing for 5 Gold Krugerrands has been sold at $1850.00 each',
                    created_at: new Date()
                }
            ];

            notifications.forEach(notification => {
                const tile = createNotificationTile(notification);
                notificationList.appendChild(tile);
            });
            log('âœ“ Notifications loaded', 'success');
        }

        function createNotificationTile(notification) {
            const tile = document.createElement('div');
            tile.className = 'notification-tile';

            // Determine button text and link based on type
            let buttonText = 'View';
            let targetUrl = '/account';

            if (notification.type === 'bid_filled') {
                buttonText = 'View Order';
                targetUrl = '#orders';
            } else if (notification.type === 'listing_sold') {
                buttonText = 'View Sold';
                targetUrl = '#sold';
            }

            tile.innerHTML = `
                <div class="notification-content">
                    <h4 class="notification-title">${notification.title}</h4>
                    <p class="notification-message">${notification.message}</p>
                    <p class="notification-time">Just now</p>
                </div>
                <div class="notification-actions">
                    <button class="notification-goto-btn" data-url="${targetUrl}">
                        ${buttonText}
                    </button>
                </div>
            `;

            // Add event listener to button
            const gotoBtn = tile.querySelector('.notification-goto-btn');
            gotoBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                handleGotoClick(notification.id, targetUrl);
            });

            return tile;
        }

        function handleGotoClick(notificationId, targetUrl) {
            log(`View Order button clicked! Navigating to: ${targetUrl}`, 'success');

            // Close sidebar
            closeNotificationSidebar();

            // Navigate (change hash)
            log(`Changing window.location.hash to: ${targetUrl}`, 'info');
            window.location.hash = targetUrl;
        }

        // ===================================
        // TEST FUNCTIONS
        // ===================================
        function testBidNavigation() {
            log('=== TEST: Bid â†’ Orders Navigation ===', 'info');
            handleGotoClick(1, '#orders');
        }

        function testListingNavigation() {
            log('=== TEST: Listing â†’ Sold Navigation ===', 'info');
            handleGotoClick(2, '#sold');
        }

        // Initial log
        log('Test page loaded. Click the bell icon to start testing!', 'info');
    </script>
</body>
</html>
