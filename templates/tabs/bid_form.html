{# templates/tabs/bid_form.html — Edit Bid UI with single-box grading dropdown #}
<form id="bid-form" class="edit-bid-form" method="POST" action="{{ form_action_url }}">
  {% set is_grading = (bid.requires_grading == 1 or bid.requires_grading == True) %}
  {% set grader = bid.preferred_grader or '' %}

  {% if bid %}
    <input type="hidden" name="bid_id" value="{{ bid.id }}">
  {% endif %}
  <input type="hidden" name="requires_grading" id="requires_grading" value="{{ 'yes' if is_grading else 'no' }}">
  <input type="hidden" name="preferred_grader" id="preferred_grader" value="{{ grader }}">

  <div class="edit-bid-modal">
    <h2>Edit Your Bid</h2>

    <div class="eb-grid {{ 'grading-open' if is_grading else '' }}" id="eb-grid">
      <!-- Row 1 -->
      <div class="eb-current" aria-live="polite">
        <div class="eb-label">Current item price</div>
        <div class="eb-value">${{ '%.2f'|format(current_item_price) }}</div>
      </div>

      <div class="eb-qty">
        <label for="qty-input" class="eb-label">Quantity</label>
        <input type="number"
               id="qty-input"
               name="bid_quantity"
               min="1"
               step="1"
               value="{{ bid.quantity_requested if bid else 1 }}"
               required>
        <div class="eb-hint" id="qty-hint"></div>
      </div>

      <!-- Right column: SINGLE rounded box that expands to reveal switches -->
      <div class="eb-grading" id="eb-grading" aria-expanded="{{ 'true' if is_grading else 'false' }}">
        <div class="eb-grading-label">Filter for professionally graded items</div>

        <div class="eb-grading-box" id="eb-grading-box">
          <button type="button" class="eb-grading-header" id="eb-grading-header" aria-expanded="{{ 'true' if is_grading else 'false' }}">
            <span class="eb-grading-title">Require 3rd Party Grading?</span>
            <span class="chev" id="eb-grading-chev">{{ '▴' if is_grading else '▾' }}</span>
          </button>

          <div class="eb-grading-menu" id="eb-grading-menu" aria-hidden="{{ 'false' if is_grading else 'true' }}">
            <div class="switch-row">
              <span>Any Grader</span>
              <label class="switch">
                <input type="checkbox" id="grader_any" {% if grader == 'Any' %}checked{% endif %}>
                <span class="slider"></span>
              </label>
            </div>
            <div class="divider"></div>
            <div class="switch-row">
              <span>PCGS</span>
              <label class="switch">
                <input type="checkbox" id="grader_pcgs" {% if grader == 'PCGS' %}checked{% endif %}>
                <span class="slider"></span>
              </label>
            </div>
            <div class="divider"></div>
            <div class="switch-row">
              <span>NGC</span>
              <label class="switch">
                <input type="checkbox" id="grader_ngc" {% if grader == 'NGC' %}checked{% endif %}>
                <span class="slider"></span>
              </label>
            </div>

            <p class="eb-note">
            </p>
          </div>
        </div>
      </div>

      <!-- Row 2 -->
      <div class="eb-best">
        <button type="button"
                id="best-bid-pill"
                class="pill pill-best"
                data-price="{{ '%.2f'|format(best_bid_price) }}">
          ● ${{ '%.2f'|format(best_bid_price) }}
        </button>
        <div class="pill-caption">Best Bid</div>
      </div>

      <div class="eb-custom">
        <label for="bid-price-input" class="eb-label">Custom Bid (per unit)</label>
        <div class="input-prefix">
          <span>$</span>
          <input type="number"
                 name="bid_price"
                 id="bid-price-input"
                 step="0.01"
                 min="0.01"
                 value="{{ '%.2f'|format(bid.price_per_coin) }}"
                 required>
        </div>
        <div class="eb-hint" id="price-hint"></div>
      </div>

      <!-- Row 3: collapsed → Confirm full width; expanded → Confirm spans L+C, Address sits R -->
      <button type="submit" id="eb-confirm" class="eb-confirm">Confirm</button>

      <div class="eb-address">
        <label for="address-input" class="eb-label">Delivery Address</label>
        <input type="text"
               id="address-input"
               name="delivery_address"
               placeholder="Ex: 1 Main Street"
               value="{{ bid.delivery_address or '' }}">
        <div class="eb-hint" id="address-hint"></div>
      </div>
    </div>
  </div>
</form>
