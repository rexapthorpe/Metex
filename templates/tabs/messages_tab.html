<div class="messages-tab">
  <h2 class="tab-heading">My Messages</h2>

  <div class="conversation-list">
    {% for convo in conversations %}
      <div class="conversation-tile collapsed"
           data-user-id="{{ convo.other_user_id }}"
           data-order-id="{{ convo.order_id }}"
           data-type="{{ convo.type }}">
        <!-- header -->
        <div class="tile-header">
          <div class="unread-dot {% if convo.unread_count == 0 %}hidden{% endif %}"></div>
          <div class="username">{{ convo.other_username }}</div>
          <div class="last-message">{{ convo.last_message_content }}</div>
          <div class="timestamp">{{ convo.last_message_time }}</div>
        </div>

        <!-- full history already in convo.messages -->
        <div class="message-body">
          <div class="message-history">
            {% for message in convo.messages %}
              <div class="message {% if message.sender_id == current_user_id %}sent{% else %}received{% endif %}">
                <div class="message-text">{{ message.content }}</div>
                <div class="message-time">{{ message.timestamp }}</div>
              </div>
            {% endfor %}
          </div>
          <!-- inline form -->
          <form class="message-input-row"
                data-user-id="{{ convo.other_user_id }}"
                data-order-id="{{ convo.order_id }}">
            <input type="text" class="message-input" placeholder="Type a messageâ€¦" />
            <button type="submit" class="send-button">Send</button>
          </form>
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<script src="{{ url_for('static', filename='js/tabs/messages_tab.js') }}"></script>
