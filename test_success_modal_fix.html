<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Success Modal Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }

    .modal-container {
      max-width: 600px;
      margin: 20px auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .detail-section {
      margin: 20px 0;
    }

    .detail-section h4 {
      margin-bottom: 15px;
      color: #1f2937;
      font-size: 16px;
      font-weight: 600;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #e5e7eb;
    }

    .detail-row:last-child {
      border-bottom: none;
    }

    .detail-label {
      font-weight: 500;
      color: #6b7280;
    }

    .detail-value {
      color: #1f2937;
      font-weight: 600;
    }

    .price-highlight {
      color: #059669;
      font-weight: 700;
    }

    .test-controls {
      background: #f9fafb;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .test-button {
      padding: 12px 24px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      background: #3b82f6;
      color: white;
      font-weight: 600;
    }

    .test-button:hover {
      background: #2563eb;
    }

    .console-log {
      background: #1f2937;
      color: #10b981;
      padding: 20px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin: 20px 0;
      max-height: 500px;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    .log-success {
      color: #10b981;
    }

    .log-error {
      color: #ef4444;
    }

    .log-warning {
      color: #f59e0b;
    }

    .log-info {
      color: #60a5fa;
    }
  </style>
</head>
<body>
  <div class="test-controls">
    <h2>ðŸ§ª Success Modal Pricing Fields Test</h2>
    <p>This simulates the exact success modal structure with pricing fields.</p>
    <button class="test-button" onclick="testSuccessModal()">Show Success Modal with Pricing</button>
    <button class="test-button" onclick="resetModal()">Reset Modal</button>
  </div>

  <div class="modal-container">
    <h3>Edit Listing Success Modal (Simulated)</h3>

    <div class="detail-section">
      <h4>Item Details</h4>
      <div class="detail-row">
        <span class="detail-label">Metal:</span>
        <span class="detail-value" id="success-metal">â€”</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Product Line:</span>
        <span class="detail-value" id="success-product-line">â€”</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Weight:</span>
        <span class="detail-value" id="success-weight">â€”</span>
      </div>
    </div>

    <div class="detail-section">
      <h4>Pricing Details</h4>

      <!-- Pricing Mode -->
      <div class="detail-row">
        <span class="detail-label">Pricing Mode:</span>
        <span class="detail-value" id="success-pricing-mode">â€”</span>
      </div>

      <!-- Variable Pricing: Current Spot Price -->
      <div class="detail-row" id="success-current-spot-row" style="display: none;">
        <span class="detail-label">Current Spot Price:</span>
        <span class="detail-value" id="success-current-spot">â€”</span>
      </div>

      <!-- Variable Pricing Fields -->
      <div class="detail-row" id="success-premium-row" style="display: none;">
        <span class="detail-label">Premium Above Spot:</span>
        <span class="detail-value" id="success-premium">â€”</span>
      </div>

      <div class="detail-row" id="success-floor-row" style="display: none;">
        <span class="detail-label">Floor Price (Minimum):</span>
        <span class="detail-value" id="success-floor">â€”</span>
      </div>

      <div class="detail-row" id="success-effective-row" style="display: none;">
        <span class="detail-label">Current Effective Price:</span>
        <span class="detail-value price-highlight" id="success-effective">â€”</span>
      </div>

      <!-- Static Pricing Field -->
      <div class="detail-row" id="success-static-price-row" style="display: none;">
        <span class="detail-label">Price per Item:</span>
        <span class="detail-value price-highlight" id="success-static-price">â€”</span>
      </div>
    </div>
  </div>

  <div class="console-log" id="console-output"></div>

  <script>
    const consoleOutput = document.getElementById('console-output');

    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const className = `log-${type}`;
      consoleOutput.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
      console.log(message);
    }

    function resetModal() {
      // Reset all fields
      document.getElementById('success-metal').textContent = 'â€”';
      document.getElementById('success-product-line').textContent = 'â€”';
      document.getElementById('success-weight').textContent = 'â€”';
      document.getElementById('success-pricing-mode').textContent = 'â€”';
      document.getElementById('success-current-spot').textContent = 'â€”';
      document.getElementById('success-premium').textContent = 'â€”';
      document.getElementById('success-floor').textContent = 'â€”';
      document.getElementById('success-effective').textContent = 'â€”';

      // Hide all pricing rows
      document.getElementById('success-current-spot-row').style.display = 'none';
      document.getElementById('success-premium-row').style.display = 'none';
      document.getElementById('success-floor-row').style.display = 'none';
      document.getElementById('success-effective-row').style.display = 'none';
      document.getElementById('success-static-price-row').style.display = 'none';

      consoleOutput.innerHTML = '';
      log('Modal reset to default state', 'info');
    }

    function testSuccessModal() {
      log('ðŸ§ª Starting Success Modal Test', 'info');
      log('');

      // Simulate the data that would be passed
      const data = {
        listingId: 10020,
        metal: 'Gold',
        productLine: 'APMEX',
        productType: 'Bar',
        weight: '1 kilo',
        pricingMode: 'premium_to_spot',
        spotPremium: '500.00',
        floorPrice: '5000.00',
        currentSpotPrice: 4222.77,
        effectivePrice: 4722.77  // spot + premium (NOT floor-adjusted)
      };

      log('Data object:', 'info');
      log(JSON.stringify(data, null, 2), 'info');
      log('');

      // Determine pricing mode
      const pricingMode = data.pricingMode || 'static';
      const isVariablePricing = pricingMode === 'premium_to_spot';

      log(`Pricing Mode: ${pricingMode}`, 'info');
      log(`Is Variable Pricing: ${isVariablePricing}`, isVariablePricing ? 'success' : 'warning');
      log('');

      // Populate basic fields
      document.getElementById('success-metal').textContent = data.metal || 'â€”';
      document.getElementById('success-product-line').textContent = data.productLine || 'â€”';
      document.getElementById('success-weight').textContent = data.weight || 'â€”';

      // Get all pricing elements
      const pricingModeEl = document.getElementById('success-pricing-mode');
      const currentSpotRow = document.getElementById('success-current-spot-row');
      const currentSpotEl = document.getElementById('success-current-spot');
      const premiumRow = document.getElementById('success-premium-row');
      const premiumEl = document.getElementById('success-premium');
      const floorRow = document.getElementById('success-floor-row');
      const floorEl = document.getElementById('success-floor');
      const effectiveRow = document.getElementById('success-effective-row');
      const effectiveEl = document.getElementById('success-effective');
      const staticPriceRow = document.getElementById('success-static-price-row');

      log('Elements found:', 'info');
      log(`  currentSpotRow: ${!!currentSpotRow}`, !!currentSpotRow ? 'success' : 'error');
      log(`  currentSpotEl: ${!!currentSpotEl}`, !!currentSpotEl ? 'success' : 'error');
      log(`  premiumRow: ${!!premiumRow}`, !!premiumRow ? 'success' : 'error');
      log(`  premiumEl: ${!!premiumEl}`, !!premiumEl ? 'success' : 'error');
      log(`  floorRow: ${!!floorRow}`, !!floorRow ? 'success' : 'error');
      log(`  floorEl: ${!!floorEl}`, !!floorEl ? 'success' : 'error');
      log(`  effectiveRow: ${!!effectiveRow}`, !!effectiveRow ? 'success' : 'error');
      log(`  effectiveEl: ${!!effectiveEl}`, !!effectiveEl ? 'success' : 'error');
      log('');

      if (isVariablePricing) {
        log('âœ… Showing variable pricing fields', 'success');

        // Set pricing mode
        if (pricingModeEl) {
          pricingModeEl.textContent = 'Variable (Premium to Spot)';
          log(`  â†’ Pricing mode text set`, 'success');
        }

        // Show current spot price
        if (currentSpotRow) {
          currentSpotRow.style.display = 'flex';
          const computed = window.getComputedStyle(currentSpotRow).display;
          log(`  â†’ currentSpotRow display set to: "flex"`, 'success');
          log(`  â†’ currentSpotRow COMPUTED display: "${computed}"`, computed === 'flex' ? 'success' : 'error');
        }
        if (currentSpotEl && data.currentSpotPrice !== undefined && !isNaN(data.currentSpotPrice)) {
          currentSpotEl.textContent = `$${parseFloat(data.currentSpotPrice).toFixed(2)}/oz`;
          log(`  â†’ currentSpotEl text set to: ${currentSpotEl.textContent}`, 'success');
        }

        // Show premium
        if (premiumRow) {
          premiumRow.style.display = 'flex';
          log(`  â†’ premiumRow display set to: "flex"`, 'success');
        }
        if (premiumEl && data.spotPremium !== undefined && data.spotPremium !== '') {
          premiumEl.textContent = `$${parseFloat(data.spotPremium).toFixed(2)}`;
          log(`  â†’ premiumEl text set to: ${premiumEl.textContent}`, 'success');
        }

        // Show floor
        if (floorRow) {
          floorRow.style.display = 'flex';
          log(`  â†’ floorRow display set to: "flex"`, 'success');
        }
        if (floorEl && data.floorPrice !== undefined && data.floorPrice !== '') {
          floorEl.textContent = `$${parseFloat(data.floorPrice).toFixed(2)}`;
          log(`  â†’ floorEl text set to: ${floorEl.textContent}`, 'success');
        }

        // Show effective price
        if (effectiveRow) {
          effectiveRow.style.display = 'flex';
          log(`  â†’ effectiveRow display set to: "flex"`, 'success');
        }
        if (effectiveEl && data.effectivePrice !== undefined && !isNaN(data.effectivePrice)) {
          effectiveEl.textContent = `$${parseFloat(data.effectivePrice).toFixed(2)}`;
          log(`  â†’ effectiveEl text set to: ${effectiveEl.textContent}`, 'success');
        }

        // Hide static price
        if (staticPriceRow) {
          staticPriceRow.style.display = 'none';
        }

        log('');
        log('ðŸŽ¯ Check the modal above - all pricing fields should now be VISIBLE!', 'success');
      } else {
        log('Using static pricing mode', 'info');
      }
    }

    // Auto-run on page load
    window.addEventListener('load', () => {
      log('ðŸš€ Test page loaded. Click "Show Success Modal with Pricing" to test.', 'info');
    });
  </script>
</body>
</html>
